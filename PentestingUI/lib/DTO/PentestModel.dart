class PentestTask {
  final String id;
  final String type;
  final String status;
  final String progressMessage;
  final double? duration;
  final int? threatsFound;
  final String? riskLevel;
  final String? summary;

  PentestTask({
    required this.id,
    required this.type,
    required this.status,
    required this.progressMessage,
    this.duration,
    this.threatsFound,
    this.riskLevel,
    this.summary,
  });

  PentestTask copyWith({
    String? type,
    String? status,
    String? progressMessage,
    double? duration,
    int? threatsFound,
    String? riskLevel,
    String? summary,
  }) {
    return PentestTask(
      id: id,
      type: type ?? this.type,
      status: status ?? this.status,
      progressMessage: progressMessage ?? this.progressMessage,
      duration: duration ?? this.duration,
      threatsFound: threatsFound ?? this.threatsFound,
      riskLevel: riskLevel ?? this.riskLevel,
      summary: summary ?? this.summary,
    );
  }

  // ---------- JSON helpers ----------
  factory PentestTask.fromJson(Map<String, dynamic> json) {
    // tolerate both "task_id" and "id" keys coming from backend
    final id = (json['task_id'] ?? json['id'] ?? json['taskId'])?.toString() ?? '';

    return PentestTask(
      id: id,
      type: (json['type'] ?? json['task_type'] ?? 'unknown').toString(),
      status: (json['status'] ?? 'pending').toString(),
      progressMessage: (json['progressMessage'] ??
          json['progress_message'] ??
          json['progress'] ??
          'Starting...')
          .toString(),
      duration: json['duration'] == null
          ? null
          : (json['duration'] is num ? (json['duration'] as num).toDouble() : double.tryParse(json['duration'].toString())),
      threatsFound: json['threatsFound'] ??
          json['threats_found'] ??
          (json['threats'] is num ? (json['threats'] as num).toInt() : int.tryParse(json['threats']?.toString() ?? '0')),
      riskLevel: json['riskLevel'] ?? json['risk_level'] ?? null,
      summary: json['summary']?.toString(),
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'task_id': id,
      'type': type,
      'status': status,
      'progressMessage': progressMessage,
      'duration': duration,
      'threatsFound': threatsFound,
      'riskLevel': riskLevel,
      'summary': summary,
    };
  }
}
