import 'package:flutter/material.dart';
import 'package:file_picker/file_picker.dart';

class ScopeConfig {
  // --- Vulnerability and Exploit Tools ---
  //Map<String, List<String>> vulnTools; // multiple vuln tools per category
  String exploitTool;                  // single exploit tool

  // --- Scope ---
  bool isFullPentest;                  // full vs custom
  Map<String, List<String>> selectedAreas;
  bool isAdvanced;                     // advanced mode toggle

  //---Subnet Mask---
  bool isSubnetMask;

  // --- Port Options ---
  String portMode;                      // top10 | all | custom
  TextEditingController customPortsController = TextEditingController();

  // --- Packet Type ---
  String packetType;                    // TCP | UDP | Both

  // --- Other Controllers ---
  List<TextEditingController> ipControllers = [TextEditingController()];

  List<PlatformFile> insiderFiles = [];
  List<PlatformFile> codebaseFiles = [];

  Map<String, List<String>> backupAreas = {};

  String ip_state;
  List<String> compromisedInsider;

  bool isScopeEnabled;
  // --- Scope Type ---
  String scope;

  ScopeConfig({
    List<String>? compromisedInsider,
    this.exploitTool = "Default",
    this.isFullPentest = false,
    Map<String, List<String>>? selectedAreas,
    this.isAdvanced = false,
    this.portMode = "top10",
    this.packetType = "TCP",
    this.scope = "black",
    this.isSubnetMask=false,
    this.ip_state="Single Ip Target(s)",
    this.isScopeEnabled=true,
  }) : compromisedInsider = compromisedInsider ?? List.empty(growable: true),
        selectedAreas = selectedAreas ?? {};


  void extractInsiderIPs() {
    compromisedInsider.clear();
    // For network + insider mode, odd indices (1, 3, 5...) are insider IPs
    for (int i = 1; i < ipControllers.length; i += 2) {
      final ip = ipControllers[i].text.trim();
      if (ip.isNotEmpty) {
        compromisedInsider.add(ip);
      }
    }
  }

  void dispose() {
    for (var c in ipControllers) {
      c.dispose();
    }
    customPortsController.dispose();
  }
}
