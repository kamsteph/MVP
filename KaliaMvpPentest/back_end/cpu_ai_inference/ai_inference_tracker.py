import time

class InferenceTracker:
    def __init__(self, db,event_bus):
        self.db = db
        self.event_bus=event_bus

    async def run(self, model_name, func, *args, **kwargs):
        start = time.time()
        result = await func(*args, **kwargs)
        duration = time.time() - start

        telemetry = {
            "model_name": model_name,
            "duration": duration,
            "cost_estimate_usd": round(duration * 0.0005, 6),
        }
        self.db.db.get_collection("inference_logs").insert_one(telemetry)
        return result
