from back_end.network_cap_matrix import NETWORK_CAPABILITY_MATRIX


def bootstrap_network_capability_matrix():
    from pymongo import MongoClient, ASCENDING
    import os
    from dotenv import load_dotenv

    load_dotenv()
    MONGO_URI = os.getenv("MONGO_URI", "mongodb://localhost:27017/")
    client = MongoClient(MONGO_URI)
    db = client.get_database("ai_pentest_dbs")
    collection = db.get_collection("capability_matrix")

    # Ensure uniqueness per attack_surface only
    collection.create_index(
        [("attack_surface", ASCENDING)],
        unique=True
    )

    for item in NETWORK_CAPABILITY_MATRIX:
        collection.update_one(
            {"attack_surface": item["attack_surface"]},
            {"$set": item},
            upsert=True
        )

    print("Network capability matrix bootstrapped successfully.")
    client.close()
