# flag_network_cves.py
import re

from back_end.database import DatabaseManager

NETWORK_KEYWORDS = [
    "network", "remote", "tcp", "udp", "port", "service",
    "protocol", "server", "socket", "connection", "packet",
    "router", "switch", "firewall", "vpn", "proxy", "ftp", "ssh",
    "dns", "smtp", "pop3", "imap", "telnet", "rmi", "rpc", "snmp"
]

def is_network_related(summary: str) -> bool:
    text = (summary or "").lower()
    return any(kw in text for kw in NETWORK_KEYWORDS)

def flag_network_related():
    db = DatabaseManager()
    cursor = db.adb.find({})
    total, flagged = 0, 0

    for doc in cursor:
        total += 1
        summary = doc.get("summary", "")
        cve = doc.get("cve", "")
        if is_network_related(summary):
            db.update("augmented_database", {"_id": doc["_id"]}, {"is_network_related": True})
            flagged += 1

    print(f"âœ… Done: {flagged}/{total} CVEs flagged as network-related.")

if __name__ == "__main__":
    flag_network_related()



