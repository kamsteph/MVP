import pytest

from back_end.database import DatabaseManager
from metrics.validator import DBResultValidator

@pytest.mark.integration
def test_network_validation_integration():
    db_manager = DatabaseManager()
    validator = DBResultValidator(db_manager)

    system_output = {
        "open_ports": [22, 80],
        "vulnerabilities": ["CVE-2023-1234"]
    }

    results = validator.validate_network(system_output, "192.168.56.102")

    assert results["ports"]["f1"] >= 0.5
    assert results["vulnerabilities"]["precision"] > 0


@pytest.mark.integration
def test_web_validation_integration():
    db_manager = DatabaseManager()
    validator = DBResultValidator(db_manager)

    system_output = {
        "endpoints": ["/login", "/admin"],
        "vulnerabilities": ["SQLi"]
    }

    results = validator.validate_web(system_output,"https://example.com")

    assert results["endpoints"]["recall"] > 0
    assert results["vulnerabilities"]["precision"] > 0
