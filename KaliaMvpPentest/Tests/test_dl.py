import asyncio

import pytest

from back_end.event_bus import EventBus
from back_end.database import DatabaseManager
from defense.deception_learning import DeceptionLearning


@pytest.mark.asyncio
async def test_dl():
    bus = EventBus()
    db = DatabaseManager()
    dl = DeceptionLearning(bus, db)

    # Fake deploy task
    task = {
        "type": "E-HONEYPOT",
        "vuln_files": [{"id": "v1", "desc": "fake vuln"}]
    }
    await dl.deploy_honeynet(task)

if __name__ == "__main__":
    asyncio.run(test_dl())

